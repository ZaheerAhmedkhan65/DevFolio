<!-- views/public/posts/_editor.ejs -->
<style>
  /* Ensure Trix content is left-aligned and lists render correctly */
  trix-editor, .trix-content {
    text-align: left !important;
    min-height: 320px;
  }
  .trix-content ul { list-style: disc !important; margin-left: 1.5rem !important; }
  .trix-content ol { list-style: decimal !important; margin-left: 1.5rem !important; }
  /* Visual cover area */
  .cover-area { border-radius: .5rem; border: 1px solid #e5e7eb; overflow: hidden; background: #fff; }
  .cover-actions { padding: 1rem; display:flex; gap:.75rem; align-items:center; }
  .cover-preview { padding: 1.25rem 1.5rem; border-top:1px solid #f3f4f6; }
  .cover-preview img { width:100%; height:260px; object-fit:cover; border-radius:.375rem; }
  .title-input { font-size: 2.25rem; font-weight: 700; line-height:1; border:0; outline:0; width:100%; }
  .excerpt-input { width:100%; border:0; outline:0; color:#6b7280; padding-top:.25rem; }
  /* Footer actions row */
  .editor-footer { display:flex; gap:1rem; align-items:center; margin-top:.75rem; }
  /* Small helper */
  .muted { color: #6b7280; }

  .tag-badge {
  background: #e5f0ff;
  color: #1a56db;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.tag-badge button {
  background: transparent;
  border: none;
  cursor: pointer;
  font-weight: bold;
  color: #1a56db;
}
.tag-badge button:hover {
  color: red;
}

#tagSuggestions div {
  padding: 8px 12px;
  cursor: pointer;
}

#tagSuggestions div:hover {
  background: #f3f4f6;
}

</style>

<div class="p-6 max-w-4xl mx-auto">
  <h1 class="text-3xl font-bold mb-6"><%= title %></h1>

  <form id="postForm" action="<%= action || '/posts/create' %>" method="POST" enctype="multipart/form-data">
    <!-- COVER / FEATURED IMAGE (top like screenshot) -->
    <div class="mb-6">
        <div class="cover-actions">
          <label for="cover-upload" class="px-4 py-2 border rounded-md cursor-pointer">Upload Cover Image</label>
          <input id="cover-upload" type="file" name="post_featured_image" accept="image/*" class="hidden">

          <!-- hidden input to store uploaded url (server returns URL on upload) -->
          <input type="hidden" id="featured_image_url" name="featured_image_url" value="<%= post?.featured_image_url || '' %>">
        </div>

        <!-- placeholder like screenshot -->
        <div id="coverPlaceholder" style="border-radius:.375rem; padding:3.5rem; background:#fafafa; text-align:left;">
            <div id="coverPreviewContainer"></div>
            <input type="text" name="title" value="<%= post?.title || '' %>"
              class="title-input" placeholder="New post title here..." />
            <div style="height:12px"></div>
            <div class="relative">
                <input type="text" id="tagsInputTop" name="tags" class="excerpt-input muted"
                    placeholder="Add up to 4 tags..." >
                <select name="tag_ids" id="tag_ids" multiple class="hidden">
                    <% tags.forEach(t=> { %>
                    <option value="<%= t.id %>"><%= t.name %></option>
                    <% }) %>
                </select>
                <!-- container to show selected tags -->
                <div id="selectedTagsContainer" class="flex flex-wrap gap-2 mt-2"></div>
                <!-- dropdown suggestions -->
                <div id="tagSuggestions"
                    class="border rounded-md bg-white shadow-md mt-1 hidden absolute z-50 w-full max-h-40 overflow-y-auto">
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="mb-4">
      <!-- hidden input that Trix will fill -->
      <input id="content" type="hidden" name="content" value="<%= post?.content || '' %>">
      <!-- do NOT use trix-content class manually; Trix manages it -->
      <trix-editor id="trixEditor" input="content" class="h-96 bg-white shadow p-3 rounded-lg overflow-y-auto"></trix-editor>
    </div>

    <!-- extra meta row (tags, categories) -->
    <div class="mb-4 grid grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold">Categories</label>
        <select name="category_ids" multiple class="w-full p-2 border rounded-lg h-28">
          <% categories.forEach(c=> { %>
            <option value="<%= c.id %>" <%= post.categories?.some(pc => pc.id == c.id) ? "selected" : "" %> >
                <%= c.name %>
            </option>
          <% }) %>
        </select>
      </div>
    </div>

    <div class="mb-4 flex items-center gap-4">
      <div>
        <label class="block font-semibold">Post Status</label>
        <select name="status" class="p-2 border rounded-lg">
          <option value="draft">Draft</option>
          <option value="published">Published</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold">Read time</label>
        <!-- visible read_time (auto-updated) and a hidden numeric value for server -->
        <input id="readTimeDisplay" type="text" readonly class="p-2 border rounded-lg w-36" value="<%= post?.read_time || 5 %> min">
        <input id="readTime" name="read_time" type="hidden" value="<%= post?.read_time || 5 %>">
      </div>

      <div class="flex items-center gap-2">
        <input type="checkbox" name="is_featured" value="true" class="w-5 h-5" <%= post?.is_featured ? "checked" : "" %> >
        <label class="font-semibold">Mark as Featured</label>
      </div>
    </div>

    <!-- submit -->
    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg w-full">Save Post</button>
  </form>
</div>